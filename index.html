<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Sains: Reaksi Kimia & Dinamikanya</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Font ramah anak: Nunito -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Nunito', sans-serif; overflow: hidden; /* Mencegah scroll body default */ }

        /* Scrollbar kustom lembut */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; border: 2px solid #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Background Polka Dot Nyaman di Mata */
        .bg-fun-science {
            background-color: #f8fafc;
            background-image: radial-gradient(#cbd5e1 2px, transparent 2px);
            background-size: 32px 32px;
            height: 100vh;
            width: 100vw;
        }

        /* Animasi */
        .animate-fade-in { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .animate-bounce-in { animation: bounceIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounceIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* Gaya Tombol 3D */
        .btn-3d {
            transition: all 0.1s ease;
            transform: translateY(0);
        }
        .btn-3d:active {
            transform: translateY(4px);
            box-shadow: none !important;
            border-bottom-width: 0px !important;
            margin-top: 4px;
        }
    </style>
</head>
<body class="bg-fun-science text-slate-800">
    <div id="root" class="h-full w-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- IKON SVG ---
        const User = ({size, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>;
        const Beaker = ({size, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4.5 3h15"></path><path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3"></path><path d="M6 14h12"></path></svg>;
        const Play = ({size, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="currentColor" className={className}><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>;
        const History = ({size, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"></path><path d="M3 3v9h9"></path><path d="M12 7v5l3 3"></path></svg>;
        const AlertTriangle = ({size, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>;
        const Heart = ({fill, className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg>;
        const CheckCircle = ({size, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>;
        const XCircle = ({size, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>;
        const Trophy = ({size, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M12 15.5v2.5"></path><path d="m6 9 3.5 10h5L18 9"></path><path d="M6 3h12a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1Z"></path></svg>;
        const LogOut = ({size, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>;
        const CloudUpload = ({size, className}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"></path><path d="M12 12v9"></path><path d="m16 16-4-4-4 4"></path></svg>;

        // --- KONFIGURASI GOOGLE SHEETS ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzICMC4iMc3wV92Oj0ixbWxFb7W6NpbvKEeLVqbMcONri6vQb_fGH6h7fNQmuUAU7BYRg/exec";

        // --- DATA SOAL REAKSI KIMIA (40 Soal) ---
        const MASTER_QUESTIONS = [
          { id: 1, question: "Perbedaan mendasar antara perubahan fisika dan perubahan kimia adalah....", options: ["Perubahan fisika menghasilkan zat baru, sedangkan kimia tidak", "Perubahan kimia bersifat ireversibel (tidak dapat kembali), sedangkan fisika biasanya reversibel", "Perubahan fisika selalu melibatkan perubahan suhu, sedangkan kimia tidak", "Perubahan kimia hanya terjadi pada benda padat"], correctAnswer: "Perubahan kimia bersifat ireversibel (tidak dapat kembali), sedangkan fisika biasanya reversibel" },
          { id: 2, question: "Manakah di antara peristiwa berikut yang tergolong perubahan fisika?", options: ["Besi berkarat karena air hujan", "Susu menjadi basi", "Lilin meleleh saat dipanaskan", "Kayu dibakar menjadi abu"], correctAnswer: "Lilin meleleh saat dipanaskan" },
          { id: 3, question: "Dalam persamaan reaksi 2H‚ÇÇ(g) + O‚ÇÇ(g) ‚Üí 2H‚ÇÇO(l), zat yang disebut sebagai pereaksi (reaktan) adalah....", options: ["2H‚ÇÇO", "H‚ÇÇ dan O‚ÇÇ", "O‚ÇÇ dan H‚ÇÇO", "Angka 2 di depan H"], correctAnswer: "H‚ÇÇ dan O‚ÇÇ" },
          { id: 4, question: "Dalam penulisan persamaan reaksi, simbol (s) yang mengikuti rumus kimia zat (contoh: Fe(s)) menunjukkan bahwa zat tersebut berwujud....", options: ["Gas", "Padat (Solid)", "Cair (Liquid)", "Larutan dalam air (Aqueous)"], correctAnswer: "Padat (Solid)" },
          { id: 5, question: "Simbol (aq) pada persamaan reaksi kimia menunjukkan bahwa zat tersebut berada dalam wujud....", options: ["Padatan", "Lelehan", "Gas", "Larutan terlarut dalam air"], correctAnswer: "Larutan terlarut dalam air" },
          { id: 6, question: "Reaksi penggabungan dua zat atau lebih menjadi satu senyawa baru, seperti pada 2Na + Cl‚ÇÇ ‚Üí 2NaCl, disebut reaksi....", options: ["Dekomposisi", "Sintesis (Kombinasi)", "Penggantian Tunggal", "Pembakaran"], correctAnswer: "Sintesis (Kombinasi)" },
          { id: 7, question: "Gelembung gas pada minuman bersoda terbentuk karena asam karbonat terurai menjadi air dan gas karbon dioksida. Persamaan reaksinya adalah H‚ÇÇCO‚ÇÉ ‚Üí H‚ÇÇO + CO‚ÇÇ. Jenis reaksi ini adalah....", options: ["Metatesis", "Sintesis", "Dekomposisi (Penguraian)", "Penggantian Ganda"], correctAnswer: "Dekomposisi (Penguraian)" },
          { id: 8, question: "Syarat mutlak agar reaksi pembakaran dapat terjadi adalah adanya keberadaan gas....", options: ["Nitrogen (N‚ÇÇ)", "Hidrogen (H‚ÇÇ)", "Oksigen (O‚ÇÇ)", "Karbon Dioksida (CO‚ÇÇ)"], correctAnswer: "Oksigen (O‚ÇÇ)" },
          { id: 9, question: "Perhatikan reaksi: Fe(s) + CuSO‚ÇÑ(aq) ‚Üí FeSO‚ÇÑ(aq) + Cu(s). Reaksi tersebut merupakan contoh dari....", options: ["Reaksi Penggantian Tunggal", "Reaksi Penguraian", "Reaksi Pembakaran", "Reaksi Netralisasi"], correctAnswer: "Reaksi Penggantian Tunggal" },
          { id: 10, question: "Pada reaksi metatesis (pertukaran ganda) antara larutan Timbal(II) nitrat dan Kalium iodida, terbentuk zat baru yang berwujud....", options: ["Gas berwarna merah", "Cairan berwarna biru", "Endapan padat berwarna kuning", "Uap berwarna putih"], correctAnswer: "Endapan padat berwarna kuning" },
          { id: 11, question: "Produk utama dari pembakaran sempurna gas metana (CH‚ÇÑ) dengan oksigen berlebih adalah....", options: ["CO dan H‚ÇÇ", "CO‚ÇÇ dan H‚ÇÇO", "C dan H‚ÇÇO", "CO‚ÇÇ dan H‚ÇÇ"], correctAnswer: "CO‚ÇÇ dan H‚ÇÇO" },
          { id: 12, question: "Berapa banyak molekul oksigen yang dibutuhkan untuk membakar satu molekul gas Propana (C‚ÇÉH‚Çà) secara sempurna?", options: ["2 molekul", "3 molekul", "4 molekul", "5 molekul"], correctAnswer: "5 molekul" },
          { id: 13, question: "Sifat berikut yang bukan merupakan ciri-ciri larutan asam adalah....", options: ["Memiliki rasa masam", "Memiliki pH di bawah 7", "Mengubah kertas lakmus merah menjadi biru", "Bersifat korosif terhadap logam"], correctAnswer: "Mengubah kertas lakmus merah menjadi biru" },
          { id: 14, question: "Larutan yang memiliki pH lebih dari 7, terasa licin di kulit, dan rasanya pahit adalah ciri dari....", options: ["Asam", "Basa", "Garam", "Netral"], correctAnswer: "Basa" },
          { id: 15, question: "Kertas lakmus biru akan berubah menjadi merah jika dicelupkan ke dalam larutan....", options: ["Air sabun", "Air kapur", "Cuka dapur", "Amonia"], correctAnswer: "Cuka dapur" },
          { id: 16, question: "Reaksi antara Asam Klorida (HCl) dan Natrium Hidroksida (NaOH) disebut reaksi netralisasi karena menghasilkan....", options: ["Garam dan Gas Hidrogen", "Asam baru dan Basa baru", "Garam dan Air", "Endapan logam"], correctAnswer: "Garam dan Air" },
          { id: 17, question: "Rentang skala pH yang umum digunakan untuk mengukur tingkat keasaman atau kebasaan suatu zat adalah....", options: ["0 sampai 10", "0 sampai 14", "1 sampai 100", "-10 sampai +10"], correctAnswer: "0 sampai 14" },
          { id: 18, question: "Air hujan dikategorikan sebagai hujan asam jika memiliki pH di bawah....", options: ["5,6", "7,0", "8,5", "14,0"], correctAnswer: "5,6" },
          { id: 19, question: "Bahan berikut yang tidak dapat digunakan sebagai indikator alami asam-basa adalah....", options: ["Ekstrak Kunyit", "Ekstrak Kol Ungu", "Larutan Garam Dapur", "Ekstrak Bunga Kembang Sepatu"], correctAnswer: "Larutan Garam Dapur" },
          { id: 20, question: "Petani sering menaburkan kapur (Kalsium Hidroksida) ke tanah pertanian. Tujuan tindakan ini adalah....", options: ["Membunuh hama tikus", "Menetralkan tanah yang terlalu asam", "Membuat tanah menjadi lebih keras", "Menambah kadar air dalam tanah"], correctAnswer: "Menetralkan tanah yang terlalu asam" },
          { id: 21, question: "Reaksi kimia yang melepaskan energi panas ke lingkungan sehingga suhu sekitar naik disebut reaksi....", options: ["Endotermik", "Eksotermik", "Sintesis", "Metatesis"], correctAnswer: "Eksotermik" },
          { id: 22, question: "Contoh peristiwa sehari-hari yang merupakan reaksi endotermik (menyerap panas) adalah....", options: ["Kayu terbakar api unggun", "Proses fotosintesis pada tumbuhan", "Ledakan kembang api", "Respirasi sel dalam tubuh manusia"], correctAnswer: "Proses fotosintesis pada tumbuhan" },
          { id: 23, question: "Senyawa kimia yang terdapat dalam chemical cold pack (kompres dingin instan) yang menyerap panas saat diaktifkan adalah....", options: ["Amonium Nitrat", "Natrium Klorida", "Asam Sulfat", "Kalsium Karbonat"], correctAnswer: "Amonium Nitrat" },
          { id: 24, question: "Grafik energi reaksi menunjukkan adanya 'bukit' energi yang harus dilalui pereaksi untuk menjadi produk. Energi minimum ini disebut....", options: ["Energi Kinetik", "Energi Potensial", "Energi Mekanik", "Energi Aktivasi"], correctAnswer: "Energi Aktivasi" },
          { id: 25, question: "Menurut Teori Tumbukan, reaksi kimia hanya akan terjadi apabila....", options: ["Partikel-partikel diam tidak bergerak", "Terdapat katalis dalam jumlah banyak", "Partikel bertumbukan dengan posisi tepat dan energi cukup", "Suhu lingkungan diturunkan hingga titik beku"], correctAnswer: "Partikel bertumbukan dengan posisi tepat dan energi cukup" },
          { id: 26, question: "Mengapa kenaikan suhu dapat mempercepat laju reaksi?", options: ["Karena suhu menurunkan energi aktivasi", "Karena partikel bergerak lebih lambat dan teratur", "Karena energi kinetik partikel bertambah sehingga tumbukan lebih sering terjadi", "Karena suhu mengubah wujud zat menjadi gas"], correctAnswer: "Karena energi kinetik partikel bertambah sehingga tumbukan lebih sering terjadi" },
          { id: 27, question: "Manakah cara berikut yang akan memperlambat laju reaksi pelarutan gula dalam air?", options: ["Menggunakan air panas", "Mengaduk larutan dengan cepat", "Menggunakan gula halus (bubuk)", "Menggunakan gula batu bongkahan besar"], correctAnswer: "Menggunakan gula batu bongkahan besar" },
          { id: 28, question: "Logam besi (Fe) lebih cepat berkarat jika berbentuk serbuk dibandingkan paku utuh. Faktor yang memengaruhi laju reaksi ini adalah....", options: ["Suhu", "Konsentrasi", "Luas permukaan sentuh", "Katalis"], correctAnswer: "Luas permukaan sentuh" },
          { id: 29, question: "Mengapa menyimpan makanan di dalam kulkas dapat membuatnya awet lebih lama?", options: ["Suhu rendah membunuh semua bakteri seketika", "Suhu rendah memperlambat laju reaksi kimia pembusukan oleh bakteri", "Kulkas menghilangkan oksigen dari makanan", "Makanan membeku menjadi padat sehingga bakteri mati"], correctAnswer: "Suhu rendah memperlambat laju reaksi kimia pembusukan oleh bakteri" },
          { id: 30, question: "Tindakan mengipas-ngipasi api unggun bertujuan untuk....", options: ["Menurunkan suhu kayu bakar", "Menambah konsentrasi oksigen di sekitar api", "Mengurangi luas permukaan kayu", "Menambahkan katalis angin"], correctAnswer: "Menambah konsentrasi oksigen di sekitar api" },
          { id: 31, question: "Mengapa panci bertekanan tinggi (pressure cooker) dapat mematangkan daging lebih cepat?", options: ["Karena tekanan tinggi menurunkan titik didih air", "Karena tekanan tinggi menaikkan suhu didih air sehingga reaksi pelunakan daging lebih cepat", "Karena panci tersebut menggunakan katalis logam", "Karena luas permukaan daging bertambah dalam panci"], correctAnswer: "Karena tekanan tinggi menaikkan suhu didih air sehingga reaksi pelunakan daging lebih cepat" },
          { id: 32, question: "Fungsi katalis dalam suatu reaksi kimia adalah....", options: ["Meningkatkan suhu reaksi secara drastis", "Menurunkan energi aktivasi (Ea) sehingga reaksi lebih mudah terjadi", "Menambah jumlah produk yang dihasilkan", "Mengubah reaksi endotermik menjadi eksotermik"], correctAnswer: "Menurunkan energi aktivasi (Ea) sehingga reaksi lebih mudah terjadi" },
          { id: 33, question: "Dalam tubuh makhluk hidup, terdapat katalis biologis yang mempercepat reaksi metabolisme. Zat ini disebut....", options: ["Enzim", "Hormon", "Vitamin", "Protein struktural"], correctAnswer: "Enzim" },
          { id: 34, question: "Tanpa adanya enzim, reaksi pembentukan DNA/RNA dalam tubuh diperkirakan membutuhkan waktu jutaan tahun. Dengan bantuan enzim, reaksi tersebut selesai dalam waktu....", options: ["10 jam", "10 menit", "10 detik", "10 milidetik"], correctAnswer: "10 milidetik" },
          { id: 35, question: "Dalam industri pembuatan pupuk, gas Nitrogen dan Hidrogen direaksikan menjadi Amonia. Industri menggunakan katalis berupa logam....", options: ["Tembaga (Cu)", "Besi (Fe)", "Emas (Au)", "Perak (Ag)"], correctAnswer: "Besi (Fe)" },
          { id: 36, question: "Dalam industri pembuatan Asam Sulfat (H‚ÇÇSO‚ÇÑ), katalis yang digunakan adalah....", options: ["Besi (Fe)", "Vanadium Oksida (V‚ÇÇO‚ÇÖ)", "Nikel (Ni)", "Platina (Pt)"], correctAnswer: "Vanadium Oksida (V‚ÇÇO‚ÇÖ)" },
          { id: 37, question: "Salah satu dampak negatif dari hujan asam (pH rendah) terhadap lingkungan adalah....", options: ["Menyuburkan tanaman air", "Mempercepat korosi pada bangunan logam dan patung batu kapur", "Meningkatkan populasi ikan di danau", "Mendinginkan suhu bumi secara drastis"], correctAnswer: "Mempercepat korosi pada bangunan logam dan patung batu kapur" },
          { id: 38, question: "Peristiwa 'susu menjadi asam/basi' jika dibiarkan di udara terbuka terlalu lama adalah contoh dari reaksi kimia yang disebabkan oleh....", options: ["Pembakaran oleh oksigen", "Aktivitas bakteri (biokimia)", "Penguapan air susu", "Penyubliman lemak susu"], correctAnswer: "Aktivitas bakteri (biokimia)" },
          { id: 39, question: "Manakah dari peristiwa berikut yang menunjukkan ciri perubahan kimia berupa 'terbentuknya endapan'?", options: ["Melarutkan gula dalam kopi panas", "Mencampur air dengan minyak goreng", "Mencampur larutan Timbal(II) Nitrat dengan Kalium Iodida", "Meneteskan pewarna makanan ke dalam air"], correctAnswer: "Mencampur larutan Timbal(II) Nitrat dengan Kalium Iodida" },
          { id: 40, question: "Faktor utama yang menyebabkan besi mengalami perkaratan (korosi) adalah adanya kontak langsung dengan....", options: ["Nitrogen dan Oksigen", "Air dan Oksigen", "Minyak dan Air", "Karbon Dioksida dan Nitrogen"], correctAnswer: "Air dan Oksigen" }
        ];

        // --- UTILITY FUNCTIONS ---
        const shuffleArray = (array) => {
          const newArray = [...array];
          for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
          }
          return newArray;
        };

        // --- APP UTAMA ---
        function App() {
          const [screen, setScreen] = useState('login'); 
          const [username, setUsername] = useState('');
          const [history, setHistory] = useState([]);
          
          const [questions, setQuestions] = useState([]);
          const [currentQIndex, setCurrentQIndex] = useState(0);
          const [score, setScore] = useState(0);
          const [lives, setLives] = useState(3);
          const [feedback, setFeedback] = useState(null); 
          const [cheatingWarning, setCheatingWarning] = useState(false);
          const [warningTime, setWarningTime] = useState(3);
          const [isSubmitting, setIsSubmitting] = useState(false);

          // --- CHEATING DETECTION LOGIC ---
          useEffect(() => {
            if (screen !== 'game') return;

            const handleVisibilityChange = () => {
              if (document.hidden) setCheatingWarning(true);
            };
            const handleBlur = () => {
              setCheatingWarning(true);
            };

            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('blur', handleBlur);

            return () => {
              document.removeEventListener('visibilitychange', handleVisibilityChange);
              window.removeEventListener('blur', handleBlur);
            };
          }, [screen]);

          useEffect(() => {
            let interval;
            if (cheatingWarning && screen === 'game') {
              interval = setInterval(() => {
                setWarningTime((prev) => {
                  if (prev <= 1) {
                    handleCheatingPenalty();
                    return 3;
                  }
                  return prev - 1;
                });
              }, 1000);
            } else {
              setWarningTime(3);
            }
            return () => clearInterval(interval);
          }, [cheatingWarning, screen]);

          const handleCheatingPenalty = () => {
            setCheatingWarning(false);
            endGame("Yah, Kuis Terhenti (Keluar Tab)");
          };

          const handleReturnToFocus = () => {
            setCheatingWarning(false);
            setWarningTime(3);
          };

          // --- GAMEPLAY LOGIC ---
          const handleLogin = (e) => {
            e.preventDefault();
            if (username.trim()) setScreen('menu');
          };

          const startGame = () => {
            const shuffledQ = shuffleArray(MASTER_QUESTIONS).map(q => ({
              ...q,
              options: shuffleArray(q.options)
            }));
            
            setQuestions(shuffledQ);
            setCurrentQIndex(0);
            setScore(0);
            setLives(3);
            setFeedback(null);
            setScreen('game');
            setIsSubmitting(false);
            
            if (document.documentElement.requestFullscreen) {
              document.documentElement.requestFullscreen().catch((e) => console.log("Fullscreen blocked"));
            }
          };

          const handleAnswer = (selectedOption) => {
            if (feedback) return; 

            const currentQ = questions[currentQIndex];
            const isCorrect = selectedOption === currentQ.correctAnswer;

            if (isCorrect) {
              setFeedback('correct');
              setScore(prev => prev + 10);
              setTimeout(() => nextQuestion(), 1000);
            } else {
              setFeedback('wrong');
              const newLives = lives - 1;
              setLives(newLives);
              
              setTimeout(() => {
                if (newLives <= 0) {
                  endGame("Yah, Nyawa Habis üíî");
                } else {
                  nextQuestion();
                }
              }, 1500);
            }
          };

          const nextQuestion = () => {
            setFeedback(null);
            if (currentQIndex < questions.length - 1) {
              setCurrentQIndex(prev => prev + 1);
            } else {
              endGame("Yey, Selesai Mengerjakan! üéâ");
            }
          };

          const submitToGoogleSheets = async (data) => {
            setIsSubmitting(true);
            try {
              const formData = new URLSearchParams();
              for (const key in data) {
                formData.append(key, data[key]);
              }
              await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: formData.toString()
              });
            } catch (error) {
              console.error("Gagal mengirim data:", error);
            } finally {
              setIsSubmitting(false);
            }
          };

          const endGame = (reason) => {
            const finalScore = score;
            const maxScore = questions.length * 10;
            let grade = "Tetap Semangat! üí™";
            if (finalScore >= maxScore * 0.9) grade = "Super Jenius! üåü";
            else if (finalScore >= maxScore * 0.7) grade = "Wah, Hebat! üî•";
            else if (finalScore >= maxScore * 0.5) grade = "Cukup Bagus! üëç";

            const timestamp = new Date().toLocaleString();
            const newHistory = { date: timestamp, score: finalScore, reason: reason, grade: grade };

            setHistory([newHistory, ...history]);
            setScreen('result');
            
            submitToGoogleSheets({
              nama: username, nilai: finalScore, predikat: grade, status: reason, waktu: timestamp
            });
            
            if (document.exitFullscreen) {
              document.exitFullscreen().catch(e => console.log("Exit fullscreen error"));
            }
          };

          // --- RENDER SCREENS ---

          if (screen === 'login') {
            return (
              <div className="h-screen w-full flex items-center justify-center p-4 overflow-hidden">
                <div className="bg-white p-6 md:p-10 rounded-3xl shadow-xl w-full max-w-md border-b-4 border-blue-200 animate-bounce-in max-h-[90vh] overflow-y-auto custom-scrollbar">
                  <div className="flex justify-center mb-4">
                    <div className="bg-blue-50 p-4 rounded-full shadow-inner">
                      <Beaker size={48} className="text-blue-500 animate-pulse" />
                    </div>
                  </div>
                  <h1 className="text-2xl md:text-3xl font-black text-center text-slate-800 mb-2">Halo, Sobat Sains! üëã</h1>
                  <p className="text-center text-slate-500 font-semibold mb-6 md:mb-8 text-sm md:text-base">Ketik namamu untuk mulai petualangan seru ini!</p>
                  
                  <form onSubmit={handleLogin} className="space-y-5 md:space-y-6">
                    <div>
                      <input 
                        type="text" 
                        value={username}
                        onChange={(e) => setUsername(e.target.value)}
                        className="w-full px-4 py-3 md:px-5 md:py-4 bg-slate-50 border-2 border-slate-200 rounded-2xl focus:border-blue-400 focus:bg-white focus:ring-4 focus:ring-blue-100 outline-none transition text-base md:text-lg font-bold text-center placeholder-slate-400"
                        placeholder="Namamu di sini..."
                        required
                        maxLength={20}
                      />
                    </div>
                    <button 
                      type="submit"
                      className="w-full bg-blue-500 text-white py-3 md:py-4 rounded-2xl font-black text-lg md:text-xl border-b-4 border-blue-700 hover:bg-blue-400 btn-3d shadow-md"
                    >
                      Mulai Main! üöÄ
                    </button>
                  </form>
                </div>
              </div>
            );
          }

          if (screen === 'menu') {
            return (
              <div className="h-screen w-full p-4 md:p-8 overflow-y-auto custom-scrollbar">
                <div className="max-w-4xl mx-auto space-y-6 md:space-y-8 pt-4 md:pt-10 animate-fade-in">
                  
                  {/* Banner Sapaan */}
                  <div className="bg-gradient-to-br from-blue-500 to-indigo-500 p-6 md:p-8 rounded-3xl shadow-lg text-white border-b-4 md:border-b-8 border-indigo-700">
                    <h1 className="text-2xl md:text-3xl font-black mb-2">Siap Beraksi, {username}? üåü</h1>
                    <p className="font-medium text-blue-100 text-sm md:text-lg">Buktikan kemampuanmu di kuis Reaksi Kimia & Dinamikanya!</p>
                  </div>

                  <div className="grid md:grid-cols-2 gap-4 md:gap-6">
                    {/* Tombol Mulai */}
                    <button 
                      onClick={startGame}
                      className="bg-white p-6 md:p-8 rounded-3xl shadow-sm border-2 border-slate-100 border-b-8 hover:border-emerald-300 hover:bg-emerald-50 transition group flex flex-col items-center justify-center gap-3 md:gap-4 btn-3d"
                    >
                      <div className="bg-emerald-400 p-4 rounded-full text-white shadow-inner group-hover:scale-110 transition-transform">
                        <Play size={40} className="md:w-12 md:h-12" />
                      </div>
                      <span className="font-black text-xl md:text-2xl text-slate-700 group-hover:text-emerald-600">Main Sekarang</span>
                      <span className="text-xs md:text-sm font-bold text-emerald-600 bg-emerald-100 px-3 py-1.5 rounded-full">Fokus Mode üéØ</span>
                    </button>

                    {/* Riwayat */}
                    <div className="bg-white p-5 md:p-6 rounded-3xl shadow-sm border-2 border-slate-100 border-b-8 flex flex-col">
                      <div className="flex items-center gap-2 md:gap-3 mb-4 text-purple-500">
                        <History size={24} className="md:w-7 md:h-7" />
                        <h2 className="font-black text-lg md:text-xl text-slate-700">Papan Skormu</h2>
                      </div>
                      <div className="flex-1 overflow-y-auto max-h-40 md:max-h-48 space-y-3 custom-scrollbar pr-2">
                        {history.length === 0 ? (
                          <div className="flex flex-col items-center justify-center h-full opacity-50 text-slate-400 pt-2">
                            <span className="text-3xl md:text-4xl mb-2">üëª</span>
                            <p className="font-bold text-sm md:text-base">Masih kosong nih!</p>
                          </div>
                        ) : (
                          history.map((h, idx) => (
                            <div key={idx} className="bg-slate-50 p-3 rounded-2xl border border-slate-200">
                              <div className="flex justify-between items-center mb-1">
                                <span className="font-black text-base md:text-lg text-slate-700">{h.score} Poin</span>
                                <span className={`text-[10px] md:text-xs font-bold px-2 md:px-3 py-1 rounded-full ${h.score > 200 ? 'bg-yellow-100 text-yellow-700' : 'bg-blue-100 text-blue-700'}`}>
                                  {h.grade.replace(/[^a-zA-Z !]/g, '')}
                                </span>
                              </div>
                              <div className="text-[10px] md:text-xs font-bold text-slate-400 truncate">
                                {h.reason}
                              </div>
                            </div>
                          ))
                        )}
                      </div>
                    </div>
                  </div>

                  {/* Aturan Main */}
                  <div className="bg-white p-5 md:p-6 rounded-3xl shadow-sm border-2 border-slate-100 border-b-4 flex items-start gap-3 md:gap-4 mb-10">
                    <div className="bg-amber-100 p-2 rounded-full mt-1 shrink-0">
                      <AlertTriangle size={20} className="text-amber-500 md:w-6 md:h-6" />
                    </div>
                    <div>
                      <p className="font-black text-base md:text-lg text-slate-700 mb-1 md:mb-2">Aturan Main üéÆ</p>
                      <ul className="list-disc list-inside space-y-1 md:space-y-2 font-medium text-sm md:text-base text-slate-500">
                        <li>Jangan buka tab/aplikasi lain saat kuis ya!</li>
                        <li>Kalau keluar tab > 3 detik, kuis otomatis gagal ü§´.</li>
                        <li>Kamu cuma punya 3 nyawa (‚ù§Ô∏è). Hati-hati memilih jawaban!</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          if (screen === 'result') {
            const lastResult = history[0];
            return (
              <div className="h-screen w-full flex items-center justify-center p-4 md:p-8 overflow-y-auto custom-scrollbar">
                <div className="bg-white p-6 md:p-10 rounded-[2rem] shadow-xl w-full max-w-md text-center text-slate-800 animate-bounce-in border-b-4 border-slate-200">
                  <div className="flex justify-center mb-4 md:mb-6">
                    {lastResult.score > 200 ? (
                      <div className="bg-yellow-50 p-5 md:p-6 rounded-full shadow-inner animate-bounce">
                        <Trophy size={64} className="text-yellow-500 md:w-20 md:h-20" />
                      </div>
                    ) : (
                      <div className="bg-slate-50 p-5 md:p-6 rounded-full shadow-inner">
                        <User size={64} className="text-slate-400 md:w-20 md:h-20" />
                      </div>
                    )}
                  </div>
                  
                  <p className="text-base md:text-lg font-bold text-slate-400 mb-1">Total Skormu</p>
                  <h2 className="text-4xl md:text-5xl font-black text-blue-500 mb-3 md:mb-4">{lastResult.score}</h2>
                  <div className="inline-block bg-blue-50 px-3 py-1.5 md:px-4 md:py-2 rounded-full mb-6 md:mb-8">
                    <p className="text-sm md:text-base font-black text-blue-600">{lastResult.grade}</p>
                  </div>
                  
                  <div className="bg-slate-50 p-4 md:p-5 rounded-2xl mb-6 md:mb-8 text-left border border-slate-100 font-semibold space-y-2 md:space-y-3">
                    <div className="flex items-center gap-3">
                      <div className="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-sm md:text-base">üìå</div>
                      <div className="flex-1">
                        <p className="text-[10px] md:text-xs text-slate-400">Status Akhir</p>
                        <p className="text-sm md:text-base text-slate-700">{lastResult.reason}</p>
                      </div>
                    </div>
                    
                    <div className="flex items-center gap-2 mt-2 pt-3 md:pt-4 border-t border-slate-100 text-[10px] md:text-xs text-slate-500 font-bold">
                        <CloudUpload size={16} className={isSubmitting ? "animate-pulse text-blue-400" : "text-emerald-400"} />
                        <span>{isSubmitting ? "Menyimpan nilaimu..." : "Nilaimu sudah tersimpan! ‚ú®"}</span>
                    </div>
                  </div>

                  <button 
                    onClick={() => setScreen('menu')}
                    className="w-full bg-blue-500 text-white py-3 md:py-4 rounded-2xl font-black text-base md:text-xl border-b-4 border-blue-700 hover:bg-blue-400 btn-3d shadow-md"
                  >
                    Kembali ke Menu
                  </button>
                </div>
              </div>
            );
          }

          // --- GAME SCREEN ---
          const currentQ = questions[currentQIndex];

          return (
            <div className="h-screen w-full flex flex-col relative overflow-hidden font-sans bg-slate-50/50">
              
              {/* Cheating Overlay */}
              {cheatingWarning && (
                <div className="fixed inset-0 z-50 bg-amber-500/90 flex flex-col items-center justify-center text-center p-6 md:p-8 backdrop-blur-sm">
                  <div className="bg-white p-6 md:p-10 rounded-[2rem] shadow-2xl max-w-sm w-full animate-bounce-in border-b-4 border-amber-600">
                    <div className="text-5xl md:text-6xl mb-3 md:mb-4">üëÄ</div>
                    <h1 className="text-2xl md:text-3xl font-black text-slate-800 mb-2">Ups! Hayo...</h1>
                    <p className="text-base md:text-lg font-bold text-slate-500 mb-4 md:mb-6">Jangan buka tab lain ya, nanti diskualifikasi lho!</p>
                    
                    <div className="text-4xl md:text-5xl font-black text-red-500 mb-6 md:mb-8 animate-pulse">
                      00:0{warningTime}
                    </div>
                    
                    <button 
                      onClick={handleReturnToFocus}
                      className="w-full bg-amber-500 text-white py-3 md:py-4 rounded-2xl font-black text-lg md:text-xl border-b-4 border-amber-700 hover:bg-amber-400 btn-3d"
                    >
                      Oke, Aku Kembali!
                    </button>
                  </div>
                </div>
              )}

              {/* Header HUD - Fixed Top */}
              <div className="flex-none p-3 md:p-4 bg-white/95 backdrop-blur-md border-b shadow-sm flex flex-col md:flex-row gap-3 md:gap-6 items-center justify-between z-40">
                
                {/* Progress Bar */}
                <div className="w-full md:w-1/3 bg-slate-100 h-2.5 md:h-3 rounded-full border border-slate-200 overflow-hidden order-2 md:order-1">
                  <div 
                    className="bg-emerald-400 h-full transition-all duration-500 rounded-full" 
                    style={{ width: `${((currentQIndex + 1) / questions.length) * 100}%` }}
                  ></div>
                </div>

                {/* Info Stats */}
                <div className="flex w-full md:w-auto items-center justify-between md:justify-center gap-3 md:gap-4 px-4 py-2 bg-slate-50 rounded-2xl border border-slate-200 order-1 md:order-2">
                  <div className="flex items-center gap-1.5 text-red-500">
                    <Heart fill="currentColor" size={20} className={lives === 1 ? "animate-pulse" : ""} />
                    <span className="font-black text-lg md:text-xl">{lives}</span>
                  </div>
                  <div className="h-5 w-0.5 bg-slate-200 rounded-full"></div>
                  <div className="font-black text-lg md:text-xl text-blue-500">
                    ‚≠ê {score}
                  </div>
                  <div className="h-5 w-0.5 bg-slate-200 rounded-full"></div>
                  <div className="font-bold text-sm md:text-base text-slate-400">
                     {currentQIndex + 1}/{questions.length}
                  </div>
                </div>
              </div>

              {/* Question Container - Internal Scroll */}
              <div className="flex-1 overflow-y-auto p-4 md:p-8 custom-scrollbar relative z-0">
                <div className="max-w-3xl mx-auto pb-10">
                  
                  {/* Question Card */}
                  <div className="bg-white rounded-[2rem] p-6 md:p-10 shadow-sm mb-6 md:mb-8 min-h-[160px] md:min-h-[200px] flex items-center justify-center relative border-b-4 md:border-b-8 border-slate-100">
                    <h2 className="text-lg md:text-2xl font-black text-center text-slate-700 leading-relaxed">
                      {currentQ.question}
                    </h2>
                    
                    {/* Feedback Icon Overlay */}
                    {feedback === 'correct' && (
                      <div className="absolute inset-0 bg-emerald-400 rounded-[2rem] flex flex-col items-center justify-center text-white animate-bounce-in z-20">
                        <CheckCircle size={64} className="mb-2 md:mb-4 drop-shadow-sm md:w-20 md:h-20" />
                        <span className="text-3xl md:text-4xl font-black drop-shadow-sm">Benar! üéâ</span>
                        <span className="text-sm md:text-lg font-bold mt-2 bg-white/20 px-3 md:px-4 py-1 rounded-full">+10 Poin</span>
                      </div>
                    )}
                    
                    {feedback === 'wrong' && (
                      <div className="absolute inset-0 bg-red-400 rounded-[2rem] flex flex-col items-center justify-center text-white animate-bounce-in z-20">
                        <XCircle size={64} className="mb-2 md:mb-4 drop-shadow-sm md:w-20 md:h-20" />
                        <span className="text-3xl md:text-4xl font-black drop-shadow-sm">Yah, Salah üòÖ</span>
                        <span className="text-sm md:text-base font-bold mt-2 bg-white/20 px-3 md:px-4 py-1 rounded-full">Nyawa berkurang</span>
                      </div>
                    )}
                  </div>

                  {/* Options Grid */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                    {currentQ.options.map((option, idx) => {
                      let btnClass = "p-4 md:p-5 rounded-2xl border-2 md:border-4 text-left transition-all duration-200 shadow-sm flex items-center gap-3 md:gap-4 text-sm md:text-lg ";
                      
                      const colors = [
                        "border-blue-100 bg-white hover:border-blue-300 hover:bg-blue-50 text-slate-700",
                        "border-amber-100 bg-white hover:border-amber-300 hover:bg-amber-50 text-slate-700",
                        "border-emerald-100 bg-white hover:border-emerald-300 hover:bg-emerald-50 text-slate-700",
                        "border-purple-100 bg-white hover:border-purple-300 hover:bg-purple-50 text-slate-700"
                      ];

                      if (feedback === 'correct' && option === currentQ.correctAnswer) {
                          btnClass = "p-4 md:p-5 rounded-2xl border-2 md:border-4 text-left flex items-center gap-3 md:gap-4 text-sm md:text-lg border-emerald-500 bg-emerald-500 text-white scale-[1.02] z-10 font-bold shadow-md";
                      } else if (feedback === 'wrong' && option !== currentQ.correctAnswer) {
                          btnClass = "p-4 md:p-5 rounded-2xl border-2 md:border-4 text-left flex items-center gap-3 md:gap-4 text-sm md:text-lg border-slate-200 bg-slate-50 text-slate-400 opacity-60"; 
                      } else if (feedback === 'wrong') {
                          btnClass = "p-4 md:p-5 rounded-2xl border-2 md:border-4 text-left flex items-center gap-3 md:gap-4 text-sm md:text-lg border-slate-200 bg-slate-50 text-slate-400 opacity-60"; 
                      } else {
                          btnClass += colors[idx % 4] + " font-bold active:scale-[0.98] cursor-pointer";
                      }

                      const clickHandler = feedback ? null : () => handleAnswer(option);
                      const labels = ["A", "B", "C", "D"];

                      return (
                        <button 
                          key={idx}
                          onClick={clickHandler}
                          disabled={!!feedback}
                          className={btnClass}
                        >
                          <div className={`w-8 h-8 md:w-10 md:h-10 shrink-0 flex items-center justify-center rounded-xl text-sm md:text-lg font-black ${feedback === 'correct' && option === currentQ.correctAnswer ? 'bg-white/20 text-white' : 'bg-slate-100 text-slate-400'}`}>
                            {labels[idx]}
                          </div>
                          <span className="leading-snug">{option}</span>
                        </button>
                      );
                    })}
                  </div>
                </div>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>